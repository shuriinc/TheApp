<!--  Header -->
<!-- <div ng-show="!hideHeader" class="item itemDivider item-icon-left item-icon-right  {{(isOpen? ' bgEnergized' : 'item-stable')}}"> -->
<div class="item itemDivider item-icon-left item-icon-right  {{(isOpen? ' bgEnergized' : 'item-stable')}}" ng-if="tweets.length || rssPosts.length">
    <i class="icon ion-ios-bolt positive" style="font-size:1.5em;" ng-click="isOpen = !isOpen;"></i>
    <div ng-click="isOpen = !isOpen;">
        <div>Media Feed</div>
    </div>
</div>

<!-- Top Buttons -->
<div ng-if="isOpen" class="button-bar" style="border-bottom: 1px solid black;">
  <div ng-disabled="" style="border-radius: 0px;" ng-class="twitterSelected ? 'button button-positive' : 'button button-stable'" ng-click="selectTab('twitter')"> Twitter </span></div>
  <div ng-if="entityType != 4" ng-disabled="" style="border-radius: 0px; border-left: 1px solid black;" ng-class="researchSelected ? 'button button-positive' : 'button button-stable'" ng-click="selectTab('research')"> Research </div>
</div>
<sspinner ng-if="!isLoaded && isOpen" text='{{vm.wordFor("Working...")}}'></sspinner>

<!-- Research Feed -------------------->
<div ng-if="isOpen">
  <div ng-show="isLoaded && researchSelected" class="bgCalmLight">
    <!--  the list NO scrolling-->
    <ion-list ng-if="!isPaged && (rssPosts.length > 0)">
      <ion-scroll ng-style="{'height': displayHeight}">
        <div ng-repeat="post in rssPosts | orderBy: '-value.date' track by $index ">
          <div ng-if="smallScale">
            <div class="list card tweetCard" ng-if="post.value.description">
              <div class="item item-text-wrap" style="padding-bottom: 0;">
                <div class="row">
                  <div class="col text-center">
                    <img ng-src="{{entity.imageUrl}}" style="max-width: 100px; border-radius: 0;">
                  </div>
                </div>
                <div class="row" style="padding: 0;">
                  <div class="col" style="padding: 0;">
                    <h2 class="link" style="margin-bottom: 0; line-height: 2.0; text-decoration: underline;" ng-click="goTo(post.name)">{{post.value.title}}</h2>
                  </div>
                </div>
              </div>
              <div class="item item-body">
                <p style="padding: 0; margin: 0; color: black;">
                  {{post.value.description}}
                </p>
                <div class="row" style="padding-left: 0; padding-right: 0;">
                  <div class="row" style="padding-left: 0; padding-right: 0;">
                    <div class="col medText" style="padding-left: 0; padding-right: 20px;">
                      {{post.value.fmtDate}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div ng-if="!smallScale">
            <div class="list card tweetCard" ng-if="post.value.description">
              <div class="item item-text-wrap" style="padding-bottom: 0;">
                <div class="row" style="padding: 0;">
                  <div class="col col-80" style="padding: 0;">
                    <h2 class="link" style="margin-bottom: 0; line-height: 2.0; text-decoration: underline;" ng-click="goTo(post.name)">{{post.value.title}}</h2>
                  </div>
                  <div class="col text-right" style="padding: 0;">
                    <img ng-src="{{entity.imageUrl}}" style="max-width: 80px; border-radius: 0;">
                  </div>
                </div>
              </div>
              <div class="item item-body">
                <p style="padding: 0; margin: 0; color: black;">
                  {{post.value.description}}
                </p>
                <div class="row" style="padding-left: 0; padding-right: 0;">
                  <div class="row" style="padding-left: 0; padding-right: 0;">
                    <div class="col text-right medText" style="padding-left: 0; padding-right: 20px;">
                      {{post.value.fmtDate}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </ion-scroll>
    </ion-list>

    <!--  the list With scrolling-->
    <ion-list ng-if="isPaged && (rssPosts.length > 0)">
      <ion-scroll ng-style="{'height': displayHeight}">
        <div ng-repeat="post in rssPosts | orderBy: '-value.date' track by $index ">
          <div ng-if="smallScale">
            <div class="list card tweetCard" ng-if="post.value.description">
              <div class="item item-text-wrap" style="padding-bottom: 0;">
                <div class="row">
                  <div class="col text-center">
                    <img ng-src="{{entity.imageUrl}}" style="max-width: 100px; border-radius: 0;">
                  </div>
                </div>
                <div class="row" style="padding: 0;">
                  <div class="col" style="padding: 0;">
                    <h2 class="link" style="margin-bottom: 0; line-height: 2.0; text-decoration: underline;" ng-click="goTo(post.name)">{{post.value.title}}</h2>
                  </div>
                </div>
              </div>
              <div class="item item-body">
                <p style="padding: 0; margin: 0; color: black;">
                  {{post.value.description}}
                </p>
                <div class="row" style="padding-left: 0; padding-right: 0;">
                  <div class="row" style="padding-left: 0; padding-right: 0;">
                    <div class="col medText" style="padding-left: 0; padding-right: 20px;">
                      {{post.value.fmtDate}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div ng-if="!smallScale">
            <div class="list card tweetCard" ng-if="post.value.description">
              <div class="item item-text-wrap" style="padding-bottom: 0;">
                <div class="row" style="padding: 0;">
                  <div class="col col-80" style="padding: 0;">
                    <h2 class="link" style="margin-bottom: 0; line-height: 2.0; text-decoration: underline;" ng-click="goTo(post.name)">{{post.value.title}}</h2>
                  </div>
                  <div class="col text-right" style="padding: 0;">
                    <img ng-src="{{entity.imageUrl}}" style="max-width: 80px; border-radius: 0;">
                  </div>
                </div>
              </div>
              <div class="item item-body">
                <p style="padding: 0; margin: 0; color: black;">
                  {{post.value.description}}
                </p>
                <div class="row" style="padding-left: 0; padding-right: 0;">
                  <div class="row" style="padding-left: 0; padding-right: 0;">
                    <div class="col text-right medText" style="padding-left: 0; padding-right: 20px;">
                      {{post.value.fmtDate}}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <ion-item ng-if="hasMore" class="button button-block ok-confirm text-center" ng-click="loadMore('research')">
        More...
      </ion-item>
    </ion-scroll>
  </ion-list>
 
    <!-- No current rss in feed -->
    <div class="item itemLabel wrapText"  ng-if="rssPosts.length == 0" >
      {{entity.name}} does not currently publish a list of their research.
      Know of one? <span class="positive link" ng-click="getFeedback(entity.name)">Tell Us</span>
    </div>

  </div>


<!-- Twitter Feed -------------------->
  <div ng-show="isLoaded && twitterSelected" class="bgPositive">
    <!--  the list NO scrolling-->
    <ion-list ng-if="!isPaged && (tweets.length > 0)">
        <ion-scroll ng-style="{'height': displayHeight}">
          <div ng-repeat="tweet in tweets | orderBy: '-createdDt' track by $index">
            <div class="list card">
              <div class="item item-avatar" style="padding-bottom: 0;">
                <img ng-src="{{tweet.value.userPic}}">
                <div class="row" style="padding: 0;">
                  <div class="col" style="padding: 0;">
                  <h2 style="margin-bottom: 0; line-height: 2.0;">{{tweet.value.userName}}</h2>
                  <a href="https://www.twitter.com/{{tweet.value.userSn}}" target="_blank" style="text-decoration: none;"><p style="color: grey;">@{{tweet.value.userSn}}</p></a>
                  </div>
                  <div class="col" style="padding: 0;">
                    <a href="https://www.twitter.com" target="_blank" class="medText" style="float: right; margin-right: 20px;"><i class="icon ion-social-twitter" style="font-size: 1.5em; color: #1DA1F2; line-height: 1.5em;"></i></a>
                  </div>
                </div>
              </div>
              <div class="item item-body">
                <div style="width: 100%; text-align: center;">
                  <img ng-if="tweet.value.mediaUrl" ng-src="{{tweet.value.mediaUrl}}" style="width: 75%;" ng-click="enlargePhoto(tweet.value.mediaUrl);">
                </div>
                <p style="padding: 0; margin: 0; color: black;" ng-bind-html="tweet.value.text.linkify_tweet()">
                </p>
                <div class="row" style="padding-left: 0; padding-right: 0;">
                  <div class="col" style="padding-left: 0; padding-right: 0;">
                  <span style="padding-right: 5px;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 72" height="28" width="28" style="fill: #AAB8C2;" ng-click="replyTweet(tweet)">
                    <path d="M41 31h-9V19c0-1.14-.647-2.183-1.668-2.688-1.022-.507-2.243-.39-3.15.302l-21 16C5.438 33.18 5 34.064 5 35s.437 1.82 1.182 2.387l21 16c.533.405 1.174.613 1.82.613.453 0 .908-.103 1.33-.312C31.354 53.183 32 52.14 32 51V39h9c5.514 0 10 4.486 10 10 0 2.21 1.79 4 4 4s4-1.79 4-4c0-9.925-8.075-18-18-18z"/>
                  </svg>
                  </span>
                  <span style="padding-right: 5px;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75 72" height="28" width="28" style="{{tweet.currentEntity.retweet ? 'fill: #19CF86;' : 'fill: #AAB8C2;'}}" ng-click="retweet(tweet)">
                    <path d="M70.676 36.644C70.166 35.636 69.13 35 68 35h-7V19c0-2.21-1.79-4-4-4H34c-2.21 0-4 1.79-4 4s1.79 4 4 4h18c.552 0 .998.446 1 .998V35h-7c-1.13 0-2.165.636-2.676 1.644-.51 1.01-.412 2.22.257 3.13l11 15C55.148 55.545 56.046 56 57 56s1.855-.455 2.42-1.226l11-15c.668-.912.767-2.122.256-3.13zM40 48H22c-.54 0-.97-.427-.992-.96L21 36h7c1.13 0 2.166-.636 2.677-1.644.51-1.01.412-2.22-.257-3.13l-11-15C18.854 15.455 17.956 15 17 15s-1.854.455-2.42 1.226l-11 15c-.667.912-.767 2.122-.255 3.13C3.835 35.365 4.87 36 6 36h7l.012 16.003c.002 2.208 1.792 3.997 4 3.997h22.99c2.208 0 4-1.79 4-4s-1.792-4-4-4z"/>
                  </svg>
                  </span>
                  <span style="padding-right: 5px;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 72" height="28" width="28" style="{{tweet.currentEntity.liked ? 'fill: #E81C4F;' : 'fill: #AAB8C2;'}}" ng-click="likeTweet(tweet)">
                    <path d="M38.723,12c-7.187,0-11.16,7.306-11.723,8.131C26.437,19.306,22.504,12,15.277,12C8.791,12,3.533,18.163,3.533,24.647 C3.533,39.964,21.891,55.907,27,56c5.109-0.093,23.467-16.036,23.467-31.353C50.467,18.163,45.209,12,38.723,12z"/>
                  </svg>
                  </span>
                  </div>
                  <div class="col smallText">
                    {{tweet.value.newtimestamp}}
                  </div>
                </div>
              </div>
              <div class="item item-button-right">
                <span class="{{entityType == 4 ? 'energized' : 'calm'}}">
                  {{entity.name}}
                </span>
                <div ng-if="!tweet.currentEntity.touchCreated" class="button button-clear" ng-click="addTouch(tweet)">
                  <i class="shuri-touch-add balanced" style="font-size: 1.5em; cursor: pointer;"></i>
                </div>
                <div ng-if="tweet.currentEntity.touchCreated" class="button button-clear">
                  <i style="font-size: .8em;" class="icon ion-checkmark-circled balanced"> Touch Created</i>
                </div>
              </div>
            </div>
          </div>
        </ion-scroll>
    </ion-list>

    <!--  the list With scrolling-->
    <ion-list ng-if="isPaged && (tweets.length > 0)">
        <ion-scroll ng-style="{'height': displayHeight}">
            <div ng-repeat="tweet in tweets | orderBy: '-createdDt' track by $index ">
              <div class="list card tweetCard">
                <div class="item item-avatar" style="padding-bottom: 0;">
                  <img ng-src="{{tweet.value.userPic}}">
                  <div class="row" style="padding: 0;">
                    <div class="col" style="padding: 0;">
                    <h2 style="margin-bottom: 0; line-height: 2.0;">{{tweet.value.userName}}</h2>
                    <a href="https://www.twitter.com/{{tweet.value.userSn}}" target="_blank" style="text-decoration: none;"><p style="color: grey;">@{{tweet.value.userSn}}</p></a>
                    </div>
                    <div class="col" style="padding: 0;">
                      <a href="https://www.twitter.com" target="_blank" class="medText" style="float: right; margin-right: 20px;"><i class="icon ion-social-twitter" style="font-size: 1.5em; color: #1DA1F2; line-height: 1.5em;"></i></a>
                    </div>
                  </div>
                </div>
                <div class="item item-body">
                  <div style="width: 100%; text-align: center;">
                    <img ng-if="tweet.value.mediaUrl" ng-src="{{tweet.value.mediaUrl}}" style="width: 75%;" ng-click="enlargePhoto(tweet.value.mediaUrl);">
                  </div>
                  <p style="padding: 0; margin: 0; color: black;" ng-bind-html="tweet.value.text.linkify_tweet()">
                  </p>
                  <div class="row" style="padding-left: 0; padding-right: 0;">
                    <div class="col" style="padding-left: 0; padding-right: 0;">
                    <span style="padding-right: 5px;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 72" height="28" width="28" style="fill: #AAB8C2;" ng-click="replyTweet(tweet)">
                      <path d="M41 31h-9V19c0-1.14-.647-2.183-1.668-2.688-1.022-.507-2.243-.39-3.15.302l-21 16C5.438 33.18 5 34.064 5 35s.437 1.82 1.182 2.387l21 16c.533.405 1.174.613 1.82.613.453 0 .908-.103 1.33-.312C31.354 53.183 32 52.14 32 51V39h9c5.514 0 10 4.486 10 10 0 2.21 1.79 4 4 4s4-1.79 4-4c0-9.925-8.075-18-18-18z"/>
                    </svg>
                    </span>
                    <span style="padding-right: 5px;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75 72" height="28" width="28" style="{{tweet.currentEntity.retweet ? 'fill: #19CF86;' : 'fill: #AAB8C2;'}}" ng-click="retweet(tweet)">
                      <path d="M70.676 36.644C70.166 35.636 69.13 35 68 35h-7V19c0-2.21-1.79-4-4-4H34c-2.21 0-4 1.79-4 4s1.79 4 4 4h18c.552 0 .998.446 1 .998V35h-7c-1.13 0-2.165.636-2.676 1.644-.51 1.01-.412 2.22.257 3.13l11 15C55.148 55.545 56.046 56 57 56s1.855-.455 2.42-1.226l11-15c.668-.912.767-2.122.256-3.13zM40 48H22c-.54 0-.97-.427-.992-.96L21 36h7c1.13 0 2.166-.636 2.677-1.644.51-1.01.412-2.22-.257-3.13l-11-15C18.854 15.455 17.956 15 17 15s-1.854.455-2.42 1.226l-11 15c-.667.912-.767 2.122-.255 3.13C3.835 35.365 4.87 36 6 36h7l.012 16.003c.002 2.208 1.792 3.997 4 3.997h22.99c2.208 0 4-1.79 4-4s-1.792-4-4-4z"/>
                    </svg>
                    </span>
                    <span style="padding-right: 5px;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54 72" height="28" width="28" style="{{tweet.currentEntity.liked ? 'fill: #E81C4F;' : 'fill: #AAB8C2;'}}" ng-click="likeTweet(tweet)">
                      <path d="M38.723,12c-7.187,0-11.16,7.306-11.723,8.131C26.437,19.306,22.504,12,15.277,12C8.791,12,3.533,18.163,3.533,24.647 C3.533,39.964,21.891,55.907,27,56c5.109-0.093,23.467-16.036,23.467-31.353C50.467,18.163,45.209,12,38.723,12z"/>
                    </svg>
                    </span>
                    </div>
                    <div class="col text-right smallText" style="padding-left: 0; padding-right: 20px;">
                      {{tweet.value.newtimestamp}}
                    </div>
                  </div>
                </div>
                <div class="item item-button-right">
                  <span class="{{entityType == 4 ? 'energized' : 'calm'}}">
                    {{entity.name}}
                  </span>
                  <div ng-if="!tweet.currentEntity.touchCreated" class="button button-clear" ng-click="addTouch(tweet)">
                    <i class="shuri-touch-add balanced" style="font-size: 1.5em; cursor: pointer;"></i>
                  </div>
                  <div ng-if="tweet.currentEntity.touchCreated" class="button button-clear">
                    <i style="font-size: .8em;" class="icon ion-checkmark-circled balanced"> Touch Created</i>
                  </div>
                </div>
              </div>

            </div>

            <ion-item ng-if="hasMore" class="button button-block ok-confirm text-center" ng-click="loadMore('twitter')">
                More...
            </ion-item>
        </ion-scroll>
    </ion-list>

    <!-- No current tweets in feed -->
      <div class="item itemLabel " ng-if="tweets.length == 0">
        No tweets found.
      </div>

    <script id="replyTweet.html" type="text/ng-template">
      <ion-modal-view>
        <ion-header-bar>
          <h1 class="title">Reply Tweet</h1>
        </ion-header-bar>
        <ion-content>
          <div class="card">
            <div class="item item-divider">
              @{{current.value.userSn}}
            </div>
          </div>
          <div class="item item-input item-stacked-label">
              <textarea class="medText" ng-model="status" rows="8" maxlength="{{140 - (current.value.userSn.length + 1)}}" ng-change="twCharactersClass = (140 - status.length) < 20 ? 'assertive' : '';"></textarea>
          </div>
          <span style="padding-left: 10px;" ng-class='twCharactersClass'>({{current.value.userSn.length + 1 + status.length}}/140 characters used) <i class="ion-social-twitter positive"></i></span>
          <div class="button button-full button-stable" ng-click="cancelTweet()">
            Cancel
          </div>
          <div class="button button-full button-balanced" ng-click="submitReply(status)">
            Submit
          </div>
        </ion-content>
      </ion-modal-view>
    </script>

    <script id="enlargePhoto.html" type="text/ng-template">
      <ion-modal-view>
        <ion-header-bar>
            <h1 class="title" ng-click="cancelEnlargeModal()">Close Image<span style="float: right;">X</span></h1>
        </ion-header-bar>
        <ion-content>
          <div>
            <img ng-src="{{enlargedImageUrl}}" style="width: 100%;">
          </div>
        </ion-content>
      </ion-modal-view>
    </script>

  </div>
</div>
